---
title: "Predicting the 2029 Canadian Federal Election Popular Vote Using Post-Stratification"
author: "GROUP 51: CAROL XU, ISLA CHEONG, MIA SUNG, VANESSA GABRIELA KWOK"
date: November 13, 2025
subtitle: STA304 - Assignment 2
format: pdf
editor: visual
---

```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(openintro)
library(tidyverse)
```

# 1 Introduction

<!-- Here you should have a few paragraphs of text introducing the problem, getting the reader interested/ready for the rest of the report. -->

<!-- Introduce terminology. -->

<!-- Highlight hypotheses. -->

<!-- Optional: You can also include a description of each section of this report as a last paragraph. -->

In this report, we aim to predict the overall popular vote in the upcoming Canadian federal election (tentatively 2029) using post-stratification based on survey and census data. The main goal is to determine the percentage of voters backing the major political parties, namely the Liberal, Conservative, and NDP parties.

Post-stratification allows us to combine survey data, which may be non-representative, with population data from the Canadian Census to produce estimates that reflect the national electorate. Understanding voting patterns by demographic factors such as age and province can provide insights into electoral trends and guide future research.

Our hypotheses are as follows:

1.  Older age groups are more likely to vote for the Conservative Party.
2.  Younger age groups are more likely to vote for the NDP.
3.  Voting preferences vary significantly across provinces.

This report is organized into the following sections: Data, Methods, Results, Discussion, Generative AI & Workflow Statement, Ethics Statement, Bibliography, and Appendix.

# 2 Data

<!-- Type here a paragraph introducing the data, its context and as much info about the data collection process that you know. -->

The information utilized in this analysis originates from two main sources: the 2021 Canadian Election Study (CES) survey data and the 2021 Canadian Census data. The CES is a nationally representative survey that gathers data on the voting habits, political views, and demographic traits of Canadian voters. The 2021 Canadian Census offers detailed demographic information on the Canadian populace, crucial for post-stratification.

```{r, include = FALSE}

# Here you can load in and clean the census data (you may need to do the cleaning in a separate R script). 

census_data <- read_csv("canada_census2021.csv")

# You may need additional chunks, in case you want to include some of the cleaning output.

```

<!-- Type here a summary of the cleaning process. You only need to describe cleaning that you and your group did. -->

We cleaned the survey and census data to ensure that variable names and categories matched, allowing seamless merging and post-stratification. Only the variables age and province were included in the model for simplicity, as these variables are present in both datasets and expected to influence voting behavior.

```{r, include = FALSE}

# Here you can load in and clean the survey data (you may want to do the cleaning in a separate R script). 

# We can load it in:
survey_data <- read_csv("ces2021.csv")

```

```{r, include = FALSE}

#### You will need to update/clean the code below based off the variables you want to use in your poststratification.

## Note: Whatever variables were chosen from the survey data need to match what's in the census data (variable names and categories)

survey_data <- 
  survey_data %>% 
  mutate(age = cps21_age,
         prov = cps21_province,
         gender = cps21_genderid,
         edu = cps21_education,
         vote_liberal = if_else(cps21_votechoice == 1, 1, 0),
         vote_conservative = if_else(cps21_votechoice == 2, 1, 0),
         vote_ndp = if_else(cps21_votechoice == 3, 1, 0)) %>% 
  select(age, prov, gender, edu, vote_liberal, vote_conservative, vote_ndp) %>%
  
  mutate(
    age = case_when(
      age >= 18 & age <= 19 ~ 7,
      age >= 20 & age <= 24 ~ 8,
      age >= 25 & age <= 29 ~ 9,
      age >= 30 & age <= 34 ~ 10,
      age >= 35 & age <= 39 ~ 11,
      age >= 40 & age <= 44 ~ 12,
      age >= 45 & age <= 49 ~ 13,
      age >= 50 & age <= 54 ~ 14,
      age >= 55 & age <= 59 ~ 15,
      age >= 60 & age <= 64 ~ 16,
      age >= 65 & age <= 69 ~ 17,
      age >= 70 & age <= 74 ~ 18,
      age >= 75 & age <= 79 ~ 19,
      age >= 80 & age <= 84 ~ 20,
      age >= 85 ~ 21,
      TRUE ~ NA_real_
      ),
    
    prov = recode(prov,
                  '1' = 48, #AB
                  '2' = 59, #BC
                  '3' = 46, #MB
                  '4' = 13, #NB
                  '5' = 10, #NL
                  '6' = 70, #North West T --> North
                  '7' = 12, #NS
                  '8' = 70, #Nunavut --> North
                  '9' = 35, #ON
                  '10' = 11, #PEI
                  '11' = 24, #QC
                  '12' = 47, #SK
                  '13' = 70 #Yukon --> North
                  ),
    
    gender = case_when(
      gender == 1 ~ 2, #Man
      gender == 2 ~ 1, #Woman
      gender %in% c(3,4) ~ NA_real_
    ),
    
    edu = case_when(
      edu %in% c(1, 2) ~ 1, #high skl or less
      edu %in% c(3, 4, 5, 6, 7, 8) ~ 2, #completed some college
      edu %in% c(9, 10, 11) ~ 3, #College degree
      edu == 12 ~ NA_real_
    )
  ) %>%
  drop_na(age, prov, gender, edu, vote_liberal) %>%
  
  mutate(
    age = factor(age,
                          levels = 7:21,
                          labels = c("18–19", "20–24", "25–29", "30–34", "35–39",
                                     "40–44", "45–49", "50–54", "55–59", "60–64",
                                     "65–69", "70–74", "75–79", "80–84", "85+")),
    prov = factor(prov,
                        levels = c(10, 11, 12, 13, 24, 35, 46, 47, 48, 59, 70),
                        labels = c("NL", "PEI", "NS", "NB", "QC", "ON",
                                   "MB", "SK", "AB", "BC", "North")),
    gender = factor(gender,
                          levels = c(1, 2),
                          labels = c("Woman", "Man")),
    
    edu = factor(edu,
                          levels = c(1, 2, 3),
                          labels = c("High school or less",
                                     "Completed some college",
                                     "College degree"))
  )
  


census_data <- census_data %>% 
  mutate(
    age = round(agegrp),
    prov = pr,
    gender = gender,
    edu = hdgree
  ) %>%
  
  select(age, prov, gender, edu) %>%
  
  mutate(
    edu = case_when(
      edu %in% c(1, 2) ~ 1, #high skl or less
      edu %in% c(3, 4, 5, 6, 7, 8) ~ 2, #completed some college
      edu %in% c(9, 10, 11, 12, 13) ~ 3, #College degree
      TRUE ~ NA_real_
      ),
    
    age = ifelse(age < 7, NA, age)
  ) %>%
  
  drop_na(age, prov, gender, edu) %>%
  
  mutate(
    gender = factor(gender,
                          levels = c(1, 2),
                          labels = c("Woman", "Man")),
    edu = factor(edu,
                          levels = c(1, 2, 3),
                          labels = c("High school or less",
                                     "Completed some college",
                                     "College degree")),
    prov = factor(prov,
                        levels = c(10, 11, 12, 13, 24, 35, 46, 47, 48, 59, 70),
                        labels = c("NL", "PEI", "NS", "NB", "QC", "ON",
                                   "MB", "SK", "AB", "BC", "North")),
    age = factor(age,
                 levels = 7:21,
                 labels = c("18–19", "20–24", "25–29", "30–34", "35–39",
                            "40–44", "45–49", "50–54", "55–59", "60–64",
                            "65–69", "70–74", "75–79", "80–84", "85+"))
    
  )

```

Remember, you may want to use multiple datasets here, if you do end up using multiple data sets, or merging the data, be sure to describe this in the cleaning process and be sure to discuss important aspects of all the data that you used.

Include a description of the important variables.

```{r, include=FALSE}

# Use this to calculate some summary measures. 
nrow(survey_data)  # total number of respondents
names(survey_data)

gender_summary <- survey_data %>%
  count(gender) %>%
  mutate(percent = n / sum(n) * 100)

print(gender_summary)

age_summary <- survey_data %>%
  count(age) %>%
  mutate(percent = n / sum(n) * 100)

print(age_summary)

prov_summary <- survey_data %>%
  count(prov) %>%
  mutate(percent = n / sum(n) * 100)

print(prov_summary)



mean(survey_data$vote_liberal, na.rm = TRUE) #liberal vote proportion
mean(survey_data$vote_conservative, na.rm = TRUE) #conservative vote proportion
mean(survey_data$vote_ndp, na.rm = TRUE) #ndp vote proportion





```

Include a description of the numerical summaries. Remember you can use `r` to use inline R code.

```{r, echo = FALSE}

# Use this to create some plots. Should probably describe both the sample and population.
# Example Plot: Age Distribution in Survey Data
ggplot(survey_data, aes(x = age)) +
  geom_bar(fill = "skyblue", color = "black") +
  labs(title = "Age Distribution in Survey Data",
       x = "Age Group",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x=element_text(size=8, angle=30, hjust=1))

# Example Plot: Proportion
ggplot(survey_data, aes(x = age, fill = factor(vote_liberal))) +
geom_bar(position = "fill") +
scale_fill_discrete(labels=c('Not voted Liberal', 'Voted Liberal')) +
labs(y = "Proportion Voting Liberal", x = "Age Group", fill = "Vote Liberal") +
theme_minimal() +
theme(axis.text.x=element_text(size=8, angle=30, hjust=1))

ggplot(survey_data, aes(x = age, fill = factor(vote_conservative))) +
geom_bar(position = "fill") +
scale_fill_discrete(labels=c('Not voted Conservative', 'Voted Conservative')) +
labs(y = "Proportion Voting Conservative", x = "Age Group", fill = "Vote Conservative") +
theme_minimal() +
theme(axis.text.x=element_text(size=8, angle=30, hjust=1))

ggplot(survey_data, aes(x = age, fill = factor(vote_ndp))) +
geom_bar(position = "fill") +
scale_fill_discrete(labels=c('Not voted NDP', 'Voted NDP')) +
labs(y = "Proportion Voting NDP", x = "Age Group", fill = "Vote NDP") +
theme_minimal() +
theme(axis.text.x=element_text(size=8, angle=30, hjust=1))




```

<!-- Include a clear description of the plot(s). I would recommend one paragraph for each plot. -->

Figure 1: Proportion of survey respondents intending to vote for the Liberal party across age groups. Similar figures can be produced for other parties.

# 3 Methods

<!-- Include some text introducing the methodology, maybe restating the problem/goal of this analysis. -->

The analysis proceeds in two steps: (1) fitting a regression model to the survey data, and (2) post-stratification using census data.

## 3.1 Model Specifics

<!-- Here you can describe your regression model -->

<!-- I will (incorrectly) be using a linear regression model to model the proportion of voters who will vote for Donald Trump. This is a naive model. I will only be using age, which is recorded as a numeric variable, to model the probability of voting for Donald Trump. The simple linear regression model I am using is: -->

<!-- $$ y = \beta_0+\beta_1  x_{age} + \epsilon$$ -->

<!-- Where $y$ represents the .... $\beta_0$ represents.... -->

We will be using a logistic regression model to model the probability of voting for the Liberal party. The model will include age and province as predictors. The logistic regression model is specified as follows: $$ \text{logit}(P(Y=1)) = \beta_0 + \beta_1 \cdot \text{age} + \beta_2 \cdot \text{prov} $$

Where $Y$ is a binary variable indicating whether a respondent intends to vote for the Liberal party (1 = yes, 0 = no), $\beta_0$ is the intercept, and $\beta_1$, $\beta_2$ are coefficients for age and province, respectively.

```{r, include=FALSE}

# Creating the Model
model <- lm(vote_liberal ~ age + prov, data=survey_data)
liberal_model <- glm(vote_liberal ~ age + prov, data = survey_data, family = binomial)
conservative_model <- glm(vote_conservative ~ age + prov, data = survey_data, family = binomial)
ndp_model <- glm(vote_ndp ~ age + prov, data = survey_data, family = binomial)

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)

### Don't show the results/output here...

```

## 3.2 Post-Stratification

<!-- Here you should explain the poststratification process -->

<!-- In order to estimate the proportion of voters..... -->

<!-- To put math/LaTeX inline just use one set of dollar signs. Example: $\hat{y}^{PS}$ -->

<!-- To put math on its own line use two sets of dollar signs: -->

<!-- $$ include.your.mathematical.model.here.if.you.have.some.math.to.show $$ -->

<!-- All analysis for this report was programmed using `R version 4.0.2` \[2\]. -->

To estimate the overall proportion of voters for the Liberal party, we will use the fitted logistic regression model to predict voting probabilities for each demographic cell defined by age and province in the census data. The predicted probabilities will then be weighted by the population counts from the census to obtain the post-stratified estimate.

Post-stratification adjusts the survey predictions to the population distribution. For each combination of age and province: 1. Predict the probability of voting for the Liberal party using the fitted model. 2. Multiply the predicted probability by the number of individuals in that demographic cell from the census data. 3. Sum these weighted predictions across all cells and divide by the total population to get the overall estimate.

$\hat{y}^{PS}$ = $\frac{\sum_{i} P(Y=1 | \text{age}_i, \text{prov}_i) \cdot N_i}{\sum_{i} N_i}$

Where $P(Y=1 | \text{age}_i, \text{prov}_i)$ is the predicted probability of voting for the Liberal party for demographic cell $i$, and $N_i$ is the population count for that cell from the census data.

# 4 Results

```{r, include=FALSE}

#model <- lm(vote_liberal ~ age + prov, data=survey_data)
# ensure factor levels match EXACTLY
survey_data$age_num <- as.numeric(survey_data$age)
survey_data$prov_num <- as.numeric(survey_data$prov)

census_data$age_num <- as.numeric(census_data$age)
census_data$prov_num <- as.numeric(census_data$prov)

# Creating the Model
liberal_model <- glm(vote_liberal ~ age_num + prov_num, data = survey_data, family = binomial)

conservative_model <- glm(vote_conservative ~ age_num + prov_num, data = survey_data, family = binomial)

ndp_model <- glm(vote_ndp ~ age_num + prov_num,data = survey_data, family = binomial)

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)
```

```{r, include=FALSE}

# Here I will perform the post-stratification calculation
#census_data_counts <- census_data %>% 
#  group_by(age, prov) %>% 
#  summarise(n=n())

#census_data_counts$estimate <-
#  model %>% 
#  predict(newdata = census_data_counts, type="response")

#census_data_counts %>% 
#  ungroup(age) %>% 
#  mutate(liberal_predict_prop = estimate*n) %>%
#  summarise(liberal_predict = sum(liberal_predict_prop)/sum(n))

# Build Census Cell Counts
census_data_counts <- census_data %>%
group_by(age_num, prov_num) %>%
summarise(n = n(), .groups = "drop")

# Add predicted probabilities for each party using the logistic models
census_data_counts <- census_data_counts %>%
mutate(
  p_liberal = predict(liberal_model, newdata = census_data_counts, type = "response"),
  p_con = predict(conservative_model, newdata = census_data_counts, type = "response"),
  p_ndp = predict(ndp_model, newdata = census_data_counts, type = "response")
)

# Remove un-estimable cells (clean and proper)
census_data_counts <- census_data_counts %>% 
  drop_na(p_liberal, p_con, p_ndp)

# Compute post-stratified national vote share for each party
poststrat_results <- census_data_counts %>%
summarise(
  liberal = sum(p_liberal * n) / sum(n),
  conservative = sum(p_con * n) / sum(n),
  ndp = sum(p_ndp * n) / sum(n)
) 


```

Here you present your results. You may want to put them into a well formatted table. Be sure that there is some text describing the results.

Note: Alternatively you can use the `knitr::kable` function to create a well formatted table from your code. See here: <https://rmarkdown.rstudio.com/lesson-7.html>.

Remember you can use `r` to use inline R code.

```{r, echo = FALSE}

# Here you can include some relevant visualizations.
library(knitr)

results_table <- poststrat_results %>%
  pivot_longer(everything(),
               names_to = "Party",
               values_to = "PredictedShare") %>%
  mutate(PredictedShare = round(PredictedShare * 100, 1))

kable(results_table,
      col.names = c("Party", "Predicted Popular Vote (%)"),
      caption = "Post-stratified predicted national popular vote for each party.")

```

|                                      | Liberal Party | Another Party |
|--------------------------------------|---------------|---------------|
| Predicted Percentage of Popular Vote | 0.286         | ??            |
| Another Statistic?                   | ??            | ??            |

: The proportions of outcome variable of interest calculated for the following political parties: Liberal.

Include an explanation/interpretation of the visualizations. Make sure to comment on the appropriateness of the assumptions/results.

# 5 Discussion

Here you should give a summary of the Hypotheses, Methods and Results

Highlight Key Results.

Talk about big picture.

Comment on any Weaknesses.

Comment on Future Work/Next Steps

End with a concluding paragraph to wrap up the report.

\newpage

# 6 Generative AI Statement

Here is where you can explain your usage of Generative AI tool(s). Be sure to reference any tools with inline citations.

Alternatively, if you did not use Generative AI, please include a brief statement outlining your workflow for completing this assignment.

# 7 Ethics Statement

Explain how you ensured that your analysis is reproducible (e.g., documenting code, using proper statistical methods).

Since the CES 2021 data is publicly available, describe whether or not this the work completed in your report needs Research Ethics Board approval for the report the be made publicly available. Be sure to specifically discuss the privacy of human participants in this study.

# 8 Bibliography

1.  First reference in a consistent, formal citation style (e.g. APA).

2.  Second reference in a consistent, formal citation style (e.g. APA).

3.  Third reference in a consistent, formal citation style (e.g. APA).

4.  Fourth reference in a consistent, formal citation style (e.g. APA).

5.  Fifth reference in a consistent, formal citation style (e.g. APA).

# 9 Appendix

Any additional notes/derivations that are supplementary to the report can be added in an appendix. This section will not be directly graded, but may be included for completion-sake.
